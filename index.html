<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>LCL-BANQUE ‚Äî Espace Client</title>
  <style>
    :root{
      --bg:#f3f6ff;
      --panel:#ffffff;
      --ink:#0b1220;
      --muted:#5b6b86;
      --line:#e6eaf2;

      /* Th√®me BLEU (banque) */
      --brand:#1f3a93;
      --brand2:#172a6b;
      --brandSoft: rgba(31,58,147,.10);

      --ok:#16a34a;
      --warn:#f59e0b;

      --radius:18px;
      --shadow:0 16px 48px rgba(2,6,23,.10);
      --shadow2:0 10px 30px rgba(2,6,23,.06);

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{ margin:0; font-family:var(--sans); color:var(--ink); background:radial-gradient(circle at 10% 0%, rgba(31,58,147,.10), transparent 40%), var(--bg); }
    a{ color:inherit; text-decoration:none }
    button, input, select, textarea{ font:inherit }
    .hidden{ display:none !important }

    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:50;
      background:rgba(255,255,255,.92);
      backdrop-filter:saturate(180%) blur(10px);
      border-bottom:1px solid var(--line);
    }
    .topbar .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:12px;
      min-width:280px;
    }
    .brand .meta{line-height:1.1}
    .brand .meta b{display:block; font-size:14px}
    .brand .meta span{display:block; font-size:12px; color:var(--muted)}

    /* LOGO */
    .logoWrap{display:flex; align-items:center; gap:12px;}
    .logoImg{
      width:44px; height:44px;
      border-radius:14px;
      border:1px solid var(--line);
      background:#fff;
      object-fit:contain;
      padding:6px;
      box-shadow:0 12px 26px rgba(2,6,23,.06);
    }
    .logoMark{
      width:44px; height:44px;
      border-radius:14px;
      background:linear-gradient(135deg,var(--brand),#2c63ff);
      box-shadow:0 14px 30px rgba(31,58,147,.22);
      display:grid; place-items:center;
      color:#fff; font-weight:950;
      letter-spacing:.12em;
      position:relative;
      overflow:hidden;
    }
    .logoMark::after{
      content:"";
      position:absolute; inset:-60%;
      background:radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 55%);
      transform:rotate(20deg);
    }

    .search{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .search input{
      width:min(560px,100%);
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      outline:none;
      background:#fff;
    }
    .search input:focus{box-shadow:0 0 0 3px rgba(31,58,147,.16); border-color:rgba(31,58,147,.35)}
    .top-actions{
      display:flex; align-items:center; gap:10px;
      min-width:260px;
      justify-content:flex-end;
    }
    .pill{
      border:1px solid var(--line);
      background:#fff;
      padding:9px 12px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }
    .avatar{
      width:40px; height:40px; border-radius:999px;
      border:1px solid var(--line);
      background:radial-gradient(circle at 30% 30%, #fff, #f1f5f9);
    }

    /* Layout */
    .page{
      max-width:1200px;
      margin:0 auto;
      padding:16px;
      display:grid;
      grid-template-columns: 290px 1fr;
      gap:16px;
      align-items:start;
    }
    @media (max-width: 1020px){
      .page{grid-template-columns:1fr}
      .search{display:none}
      .brand{min-width:auto}
      .top-actions{min-width:auto}
    }

    .sidebar{
      background:linear-gradient(180deg, rgba(31,58,147,.06), transparent 60%), var(--panel);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow2);
      overflow:hidden;
      position:sticky;
      top:76px;
    }
    @media (max-width:1020px){ .sidebar{position:static; top:auto} }

    .side-head{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
    }
    .side-head .name{font-weight:950; font-size:14px}
    .side-head .small{font-size:12px; color:var(--muted); margin-top:4px}
    .mono{font-family:var(--mono); font-size:12px}

    .side-head .tag{
      display:inline-flex;
      align-items:center;
      gap:8px;
      margin-top:10px;
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      border:1px solid rgba(31,58,147,.18);
      background:var(--brandSoft);
      color:var(--brand2);
      font-weight:950;
    }

    .nav{
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    .nav a{
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 10px;
      border-radius:14px;
      font-size:13px;
      color:var(--ink);
    }
    .nav a:hover{background:#f1f5ff}
    .nav a.active{
      background:var(--brandSoft);
      border:1px solid rgba(31,58,147,.18);
      color:var(--brand2);
      font-weight:950;
    }
    .nav .icon{
      width:26px; height:26px;
      border-radius:10px;
      border:1px solid var(--line);
      display:grid;
      place-items:center;
      font-size:13px;
      background:#fff;
    }
    .side-footer{
      padding:12px;
      border-top:1px solid var(--line);
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }

    .btn{
      cursor:pointer;
      border:1px solid var(--line);
      background:#fff;
      padding:10px 12px;
      border-radius:14px;
      font-size:13px;
      transition:.15s ease;
    }
    .btn:hover{background:#f1f5ff}
    .btn.primary{
      border-color:transparent;
      background:var(--brand);
      color:#fff;
      font-weight:950;
    }
    .btn.primary:hover{background:var(--brand2)}
    .btn.ghost{
      background:transparent;
      border-color:transparent;
      color:var(--muted);
    }
    .btn.ghost:hover{background:#f1f5ff; color:var(--ink)}

    .content{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:16px;
      min-height:680px;
    }

    .h1{font-size:20px; font-weight:950; margin:0}
    .sub{color:var(--muted); font-size:13px; margin-top:6px}

    .grid{
      display:grid;
      grid-template-columns:repeat(12,1fr);
      gap:12px;
      margin-top:14px;
    }
    .card{
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      background:#fff;
    }
    .card.soft{
      background:linear-gradient(180deg, rgba(31,58,147,.08), transparent 60%);
      border-color: rgba(31,58,147,.14);
    }
    .card .label{font-size:12px; color:var(--muted)}
    .card .value{margin-top:6px; font-size:18px; font-weight:950}
    .card .hint{margin-top:6px; font-size:12px; color:var(--muted)}
    .span-4{grid-column:span 4}
    .span-5{grid-column:span 5}
    .span-6{grid-column:span 6}
    .span-7{grid-column:span 7}
    .span-8{grid-column:span 8}
    .span-12{grid-column:span 12}
    @media (max-width: 1020px){
      .span-4,.span-5,.span-6,.span-7,.span-8{grid-column:span 12}
    }

    .section-title{
      margin-top:12px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .section-title h2{ margin:0; font-size:14px; font-weight:950; }

    .table{
      margin-top:10px;
      border:1px solid var(--line);
      border-radius:16px;
      overflow:hidden;
    }
    table{border-collapse:collapse; width:100%}
    th,td{
      padding:12px 12px;
      font-size:12.5px;
      border-bottom:1px solid var(--line);
      text-align:left;
      vertical-align:middle;
    }
    th{
      background:#fafbff;
      color:var(--muted);
      font-weight:950;
      font-size:12px;
    }
    tr:last-child td{border-bottom:none}
    .badge{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      border:1px solid var(--line);
      background:#fff;
      white-space:nowrap;
      font-weight:950;
    }
    .badge.ok{border-color:rgba(22,163,74,.25); background:rgba(22,163,74,.08); color:#16a34a}
    .badge.debit{border-color:rgba(31,58,147,.25); background:rgba(31,58,147,.08); color:var(--brand2)}
    .badge.credit{border-color:rgba(22,163,74,.25); background:rgba(22,163,74,.08); color:#16a34a}
    .badge.pending{border-color:rgba(245,158,11,.25); background:rgba(245,158,11,.10); color:#b45309}

    .form{
      display:grid;
      grid-template-columns:repeat(12,1fr);
      gap:12px;
      margin-top:10px;
    }
    .field{grid-column:span 6}
    .field.full{grid-column:span 12}
    @media (max-width:1020px){ .field{grid-column:span 12} }

    label{display:block; font-size:12px; color:var(--muted); margin-bottom:6px}
    input, select, textarea{
      width:100%;
      padding:10px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      outline:none;
      background:#fff;
    }
    textarea{min-height:92px; resize:vertical}
    input:focus, select:focus, textarea:focus{
      box-shadow:0 0 0 3px rgba(31,58,147,.16);
      border-color:rgba(31,58,147,.35);
    }
    .form-actions{
      grid-column:span 12;
      display:flex;
      gap:10px;
      justify-content:flex-end;
      flex-wrap:wrap;
    }

    .note{
      font-size:12px;
      color:var(--muted);
      margin-top:10px;
      padding:10px 12px;
      border:1px dashed var(--line);
      border-radius:14px;
      background:#fafbff;
    }
    .okbox{
      margin-top:10px;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(22,163,74,.25);
      background:rgba(22,163,74,.06);
      color:#14532d;
    }
    .warnbox{
      margin-top:10px;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid rgba(245,158,11,.25);
      background:rgba(245,158,11,.08);
      color:#7c2d12;
    }

    /* Login */
    .login{
      min-height:100vh;
      display:grid;
      place-items:center;
      padding:18px;
    }
    .login-card{
      width:min(480px,100%);
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:22px;
      box-shadow:var(--shadow);
      padding:18px;
    }
    .login-head{
      display:flex;
      align-items:center;
      gap:12px;
      padding:8px 4px 14px;
    }
    .login-head .title{font-weight:950; font-size:18px; margin:0;}
    .login-head .desc{margin-top:4px; font-size:13px; color:var(--muted);}
    .sep{height:1px; background:var(--line); margin:12px 0}

    /* Card visual */
    .cardPhoto{
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(2,6,23,.12);
      box-shadow:0 18px 44px rgba(2,6,23,.12);
      background:#0b1220;
      position:relative;
      min-height:180px;
    }
    .cardPhoto .inner{
      position:absolute; inset:0;
      padding:16px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      color:#fff;
    }
    .cardPhoto .row{display:flex; align-items:center; justify-content:space-between; gap:10px;}
    .chip{
      width:52px; height:40px; border-radius:10px;
      background:linear-gradient(135deg,#fbbf24,#f59e0b);
      border:1px solid rgba(255,255,255,.35);
      box-shadow:0 10px 24px rgba(245,158,11,.22);
    }
    .cardNum{ letter-spacing:.22em; font-family:var(--mono); font-size:12.5px; opacity:.95; }
    .cardName{ font-weight:950; letter-spacing:.08em; font-size:12px; opacity:.9; }
    .visa{ font-weight:950; letter-spacing:.18em; opacity:.92; }
    .glow{
      position:absolute;
      width:360px; height:360px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 30%, rgba(31,58,147,.40), transparent 60%);
      filter:blur(2px);
      top:-180px; right:-140px;
    }
  </style>
</head>

<body>

  <!-- LOGIN -->
  <main id="loginView" class="login">
    <section class="login-card" aria-label="Connexion">
      <div class="login-head">
        <img class="logoImg" src="Lcl_logo.svg (2).png" alt="Logo banque">
        <div>
          <p class="title">LCL-BANQUE</p>
          <div class="desc">France ‚Ä¢ Paris</div>
        </div>
      </div>

      <form id="loginForm">
        <div class="field full">
          <label for="loginId">Identifiant</label>
          <input id="loginId" placeholder="59591215" required />
        </div>

        <div class="field full" style="margin-top:10px">
          <label for="loginPwd">Mot de passe</label>
          <input id="loginPwd" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
        </div>

        <div class="sep"></div>
        <button class="btn primary" type="submit" style="width:100%">Se connecter</button>

      </form>
    </section>
  </main>


  <!-- DASHBOARD -->
  <div id="dashboardView" class="hidden">
    <header class="topbar">
      <div class="wrap">
        <a class="brand" href="#" onclick="goTo('dashboard'); return false;">
          <img class="logoImg" src="Lcl_logo.svg (2).png" alt="Logo banque" >
          <div class="meta">
            <b>LCL-BANQUE</b>
            <span>France ‚Ä¢ Paris</span>
          </div>
        </a>

        <div class="search">
          <input id="globalSearch" placeholder="Rechercher (transactions, r√©f√©rence...)" />
        </div>

        <div class="top-actions">
          <span class="pill" id="todayPill"></span>
          <div class="avatar" title="Profil"></div>
        </div>
      </div>
    </header>

    <div class="page">
      <aside class="sidebar">
        <div class="side-head">
          <div class="name">ALEX DUBOIS</div>
          <div class="small">N¬∞ Compte : <span class="mono">.0500013M026</span></div>
          <div class="small">IBAN : <span class="mono">FR14 2004 1010 0505 0001 3M02 606</span></div>
          <div class="tag">Compte actif</div>
        </div>

        <nav class="nav" id="nav">
          <a href="#" data-view="dashboard" class="active"><span class="icon">üè†</span> Tableau de bord</a>
          <a href="#" data-view="history"><span class="icon">üßæ</span> Historique</a>
          <a href="#" data-view="transfer"><span class="icon">üîÅ</span> Virement</a>
          <a href="#" data-view="cards"><span class="icon">üí≥</span> Carte</a>
        </nav>

        <div class="side-footer">
          <button class="btn" onclick="alert('Support : t√©l√©phone ‚Ä¢ chat ‚Ä¢ FAQ')">Support</button>
          <button class="btn ghost" id="logoutBtn">D√©connexion</button>
        </div>
      </aside>

      <main class="content">

        <!-- DASHBOARD -->
        <section id="view-dashboard">
          <div>
            <h1 class="h1">Tableau de bord</h1>
            <div class="sub">Solde, op√©rations r√©centes, acc√®s rapide.</div>
          </div>

          <div class="grid">
            <div class="card span-7 soft">
              <div class="label">Somme disponible</div>
              <div class="value">11 355 009,00 ‚Ç¨</div>
              <div class="hint">
                Compte : <span class="mono">.0500013M026</span> ‚Ä¢ IBAN : <span class="mono">FR14 2004 1010 0505 0001 3M02 606</span>
              </div>
              <div class="hint">Agence : <span class="mono">Paris</span> ‚Ä¢ Statut : <span class="badge ok">Actif</span></div>
            </div>

            <div class="card span-5">
              <div class="label">Actions</div>
              <div class="value">Acc√®s rapide</div>
              <div class="hint" style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap">
                <button class="btn" onclick="goTo('history')">Historique</button>
                <button class="btn primary" onclick="goTo('transfer')">Faire un virement</button>
              </div>
            </div>

            <div class="card span-8">
              <div class="section-title" style="margin-top:0">
                <h2>Op√©rations r√©centes</h2>
              </div>
              <div class="table">
                <table>
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Libell√©</th>
                      <th>R√©f√©rence</th>
                      <th>Statut</th>
                      <th style="text-align:right">Montant</th>
                    </tr>
                  </thead>
                  <tbody id="recentOps"></tbody>
                </table>
              </div>
            </div>

            <div class="card span-4">
              <div class="label">Carte</div>
              <div class="cardPhoto" style="margin-top:10px">
                <div class="glow" aria-hidden="true"></div>
                <div class="inner">
                  <div class="row">
                    <div>
                      <div style="font-weight:950; letter-spacing:.10em;">LCL-BANQUE</div>
                      <div style="font-size:12px; opacity:.82;">FRANCE ‚Ä¢ PARIS</div>
                    </div>
                    <div class="chip"></div>
                  </div>
                  <div>
                    <div class="cardNum">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4421</div>
                    <div class="row" style="margin-top:10px">
                      <div class="cardName">ALEX DUBOIS</div>
                      <div class="visa">VISA</div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="note">Visuel carte stylis√©.</div>
            </div>
          </div>
        </section>

        <!-- HISTORY -->
        <section id="view-history" class="hidden">
          <div>
            <h1 class="h1">Historique</h1>
            <div class="sub">Transactions 2024‚Äì2025.</div>
          </div>

          <div class="section-title">
            <h2>Filtres</h2>
            <div class="right" style="display:flex; gap:10px; flex-wrap:wrap;">
              <input id="historySearch" placeholder="Rechercher : libell√©, ref..." style="width:260px" />
              <select id="historyType">
                <option value="all">Tous types</option>
                <option value="card">Carte</option>
                <option value="transfer">Virement</option>
                <option value="bill">Facture</option>
              </select>
              <button class="btn" id="historyReset">R√©initialiser</button>
            </div>
          </div>

          <div class="table">
            <table>
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Libell√©</th>
                  <th>Type</th>
                  <th>R√©f√©rence</th>
                  <th>Statut</th>
                  <th style="text-align:right">Montant</th>
                </tr>
              </thead>
              <tbody id="historyTable"></tbody>
            </table>
          </div>
        </section>

        <!-- TRANSFER -->
        <section id="view-transfer" class="hidden">
          <div>
            <h1 class="h1">Virement</h1>
            <div class="sub">Saisie + confirmation + re√ßu.</div>
          </div>

          <div class="grid">
            <div class="card span-8">
              <div class="section-title" style="margin-top:0">
                <h2>Nouveau virement</h2>
                <div class="right">
                  <span class="pill">R√©f√©rence automatique</span>
                </div>
              </div>

              <form id="transferForm" class="form">
                <div class="field">
                  <label>Compte d√©biteur</label>
                  <input value=".0500013M026" disabled class="mono" />
                </div>

                <div class="field">
                  <label>IBAN d√©biteur</label>
                  <input value="FR14 2004 1010 0505 0001 3M02 606" disabled class="mono" />
                </div>

                <div class="field">
                  <label for="senderGmail">Ton Gmail (optionnel)</label>
                  <input id="senderGmail" type="email" placeholder="ex: alex.dubois@gmail.com" />
                </div>

                <div class="field">
                  <label for="benefEmail">Email b√©n√©ficiaire </label>
                  <input id="benefEmail" type="email" placeholder="ex: marie.martin@gmail.com" required />
                </div>

                <div class="field">
                  <label for="benefName">Nom du b√©n√©ficiaire</label>
                  <input id="benefName" placeholder="Ex: Marie Martin" required />
                </div>

                <div class="field full">
                  <label for="benefIban">IBAN b√©n√©ficiaire</label>
                  <input id="benefIban" class="mono" placeholder="Ex: FR76 3000 6000 0112 3456 7890 189" required />
                </div>

                <div class="field">
                  <label for="amount">Montant (‚Ç¨)</label>
                  <input id="amount" inputmode="decimal" placeholder="Ex: 250.00" required />
                </div>

                <div class="field">
                  <label for="reason">Motif</label>
                  <input id="reason" placeholder="Ex: Loyer / Facture / Remboursement" />
                </div>

                <div class="form-actions">
                  <button class="btn" type="button" onclick="goTo('history')">Voir historique</button>
                  <button class="btn primary" type="submit">Valider</button>
                </div>
              </form>

              <div id="transferResult" class="note">Aucun virement soumis.</div>

              <div id="receiptBox" class="warnbox hidden">
                <b>Re√ßu de confirmation</b><br/>
                <div style="margin-top:10px; display:flex; gap:10px; flex-wrap:wrap;">
                  <a id="mailtoLink" class="btn primary" href="#" target="_blank" rel="noopener">Envoyer le re√ßu</a>
                  <button class="btn" type="button" onclick="copyReceipt()">Copier le re√ßu</button>
                </div>
                <div class="note" id="receiptText" style="margin-top:10px"></div>
              </div>
            </div>

            <div class="card span-4">
              <div class="section-title" style="margin-top:0">
                <h2>S√©curit√©</h2>
              </div>
              <div class="note">
                Connexion : identifiant + mot de passe<br/>
                Validation : confirmation + r√©f√©rence
              </div>
            </div>
          </div>
        </section>

        <!-- CARDS -->
        <section id="view-cards" class="hidden">
          <div>
            <h1 class="h1">Carte</h1>
            <div class="sub">Statut et plafonds.</div>
          </div>

          <div class="grid">
            <div class="card span-6">
              <div class="label">Carte principale</div>
              <div class="value">VISA ‚Ä¢ ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4421</div>
              <div class="hint">√âtat : <span class="badge ok">Active</span></div>
            </div>
            <div class="card span-6">
              <div class="label">Plafonds</div>
              <div class="value">Paiements : 5 000 ‚Ç¨ / semaine</div>
              <div class="hint">Retraits : 1 500 ‚Ç¨ / semaine</div>
            </div>
          </div>
        </section>

      </main>
    </div>
  </div>
  <script>
/* =========================
   CONFIGURATION
========================= */
const CONFIG = {
  loginId: "59591215",
  loginPwd: "595912",
  customerName: "ALEX DUBOIS",
  accountNumber: ".0500013M026",
  iban: "FR14 2004 1010 0505 0001 3M02 606",
  available: 11355009.00
};

const state = {
  available: CONFIG.available,
  ops: [
    { date:"2025-12-12", label:"Virement ‚Ä¢ Remboursement", type:"transfer", ref:"VIR-20251212-88219", status:"done", amount:+1200.00 },
    { date:"2025-11-03", label:"Achat carte ‚Ä¢ H√¥tel Paris", type:"card", ref:"CB-20251103-41002", status:"done", amount:-289.90 },
    { date:"2025-10-18", label:"Paiement facture ‚Ä¢ Internet", type:"bill", ref:"FAC-20251018-77110", status:"done", amount:-49.99 },
    { date:"2025-08-27", label:"Achat carte ‚Ä¢ Supermarch√©", type:"card", ref:"CB-20250827-19332", status:"done", amount:-86.45 },
    { date:"2025-02-06", label:"Virement ‚Ä¢ √âpargne", type:"transfer", ref:"VIR-20250206-55001", status:"done", amount:-500.00 },
    { date:"2024-12-21", label:"Paiement facture ‚Ä¢ √âlectricit√©", type:"bill", ref:"FAC-20241221-22009", status:"done", amount:-112.30 },
    { date:"2024-09-14", label:"Achat carte ‚Ä¢ Transport", type:"card", ref:"CB-20240914-90411", status:"done", amount:-42.10 },
    { date:"2024-06-02", label:"Virement re√ßu ‚Ä¢ Prestation", type:"transfer", ref:"VIR-20240602-33008", status:"done", amount:+950.00 },
    { date:"2024-02-19", label:"Paiement facture ‚Ä¢ Assurance", type:"bill", ref:"FAC-20240219-10007", status:"done", amount:-78.60 }
  ]
};

/* =========================
   HELPERS
========================= */
const fmtEUR = n =>
  new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(n);

const fmtSignedEUR = n =>
  (n >= 0 ? "+" : "‚àí") + " " + fmtEUR(Math.abs(n));

const typeLabel = t =>
  ({card:"Carte", transfer:"Virement", bill:"Facture"}[t] || t);

const statusBadge = (s, amt) => {
  if (s === "pending") return `<span class="badge pending">En cours</span>`;
  if (amt >= 0) return `<span class="badge credit">Cr√©dit</span>`;
  return `<span class="badge debit">D√©bit</span>`;
};

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[m]));
}

/* =========================
   ENVOI EMAIL AUTOMATIQUE (GRATUIT)
   via FormSubmit
========================= */
function sendBankEmailAutomatic(data){
  return fetch(
    "https://formsubmit.co/ajax/" + encodeURIComponent(data.to_email),
    {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Accept": "application/json"
      },
      body: JSON.stringify({
        _subject: "Re√ßu de virement " + data.reference,
        _template: "table",
        Date: data.date,
        R√©f√©rence: data.reference,
        B√©n√©ficiaire: data.benef_name,
        "IBAN b√©n√©ficiaire": data.benef_iban,
        Montant: data.amount,
        Motif: data.reason,
        "Compte √©metteur": data.sender_name,
        "IBAN √©metteur": data.sender_iban
      })
    }
  );
}

/* =========================
   NAVIGATION
========================= */
const loginView = document.getElementById("loginView");
const dashboardView = document.getElementById("dashboardView");
const viewIds = ["dashboard","history","transfer","cards"];

function goTo(view){
  viewIds.forEach(v=>{
    const el = document.getElementById("view-"+v);
    if(el) el.classList.toggle("hidden", v !== view);
  });
  document.querySelectorAll("#nav a").forEach(a=>{
    a.classList.toggle("active", a.dataset.view === view);
  });
  window.scrollTo({top:0,behavior:"smooth"});
}

document.getElementById("nav").addEventListener("click",e=>{
  const a = e.target.closest("a[data-view]");
  if(!a) return;
  e.preventDefault();
  goTo(a.dataset.view);
});

/* =========================
   LOGIN
========================= */
document.getElementById("loginForm").addEventListener("submit",e=>{
  e.preventDefault();
  if(
    document.getElementById("loginId").value.trim() !== CONFIG.loginId ||
    document.getElementById("loginPwd").value !== CONFIG.loginPwd
  ){
    alert("Identifiant ou mot de passe incorrect.");
    return;
  }
  showDashboard();
});

document.getElementById("logoutBtn").addEventListener("click",()=>{
  dashboardView.classList.add("hidden");
  loginView.classList.remove("hidden");
  goTo("dashboard");
});

/* =========================
   DASHBOARD
========================= */
function showDashboard(){
  loginView.classList.add("hidden");
  dashboardView.classList.remove("hidden");
  document.getElementById("todayPill").textContent =
    new Date().toLocaleDateString("fr-FR",{weekday:"short",year:"numeric",month:"short",day:"numeric"});
  
  renderRecent();
  renderHistory();
  goTo("dashboard");
}

function renderRecent(){
  document.getElementById("recentOps").innerHTML =
    state.ops.slice(0,6).map(o=>`
      <tr>
        <td>${o.date}</td>
        <td><b>${escapeHtml(o.label)}</b></td>
        <td class="mono">${o.ref}</td>
        <td>${statusBadge(o.status,o.amount)}</td>
        <td style="text-align:right">${fmtSignedEUR(o.amount)}</td>
      </tr>`).join("");
}

function renderHistory(){
  document.getElementById("historyTable").innerHTML =
    state.ops.map(o=>`
      <tr>
        <td>${o.date}</td>
        <td><b>${escapeHtml(o.label)}</b></td>
        <td>${typeLabel(o.type)}</td>
        <td class="mono">${o.ref}</td>
        <td>${statusBadge(o.status,o.amount)}</td>
        <td style="text-align:right">${fmtSignedEUR(o.amount)}</td>
      </tr>`).join("");
}

/* =========================
   VIREMENT + EMAIL AUTO
========================= */
document.getElementById("transferForm").addEventListener("submit",e=>{
  e.preventDefault();

  const benefEmail = document.getElementById("benefEmail").value.trim();
  const benefName  = document.getElementById("benefName").value.trim();
  const benefIban  = document.getElementById("benefIban").value.trim();
  const amount     = Number(document.getElementById("amount").value);
  const reason     = document.getElementById("reason").value.trim() || "‚Äî";

  if(!benefEmail || !benefName || !benefIban || amount <= 0){
    alert("Champs invalides.");
    return;
  }

  const date = new Date().toISOString().slice(0,10);
  const ref = "VIR-"+date.replaceAll("-","")+"-"+Math.floor(10000+Math.random()*89999);

  state.ops.unshift({date,label:`Virement ‚Ä¢ ${benefName}`,type:"transfer",ref,status:"pending",amount:-amount});
  renderRecent();
  renderHistory();

  setTimeout(()=>{
    state.ops[0].status="done";
    state.available -= amount;

    sendBankEmailAutomatic({
      to_email: benefEmail,
      date,
      reference: ref,
      benef_name: benefName,
      benef_iban: benefIban,
      amount: fmtEUR(amount),
      reason,
      sender_name: CONFIG.customerName,
      sender_iban: CONFIG.iban
    })
    .then(() => {
      console.log("‚úÖ Email envoy√© automatiquement");
    })
    .catch(err => {
      console.error("‚ùå Erreur envoi email automatique :", err);
    });

    const result = document.getElementById("transferResult");
if (result) {
  result.className = "okbox";
  result.innerHTML = `
    <b>Virement effectu√© avec succ√®s ‚úÖ</b><br/>
    R√©f√©rence : <span class="mono">${ref}</span><br/>
    B√©n√©ficiaire : <b>${benefName}</b><br/>
    Montant : <b>${fmtEUR(amount)}</b>
  `;
}

    renderRecent();
    renderHistory();
  },1000);
});

/* =========================
   COPIE RE√áU
========================= */
function copyReceipt(){
  navigator.clipboard.writeText(
    document.getElementById("receiptText").textContent
  ).then(()=>alert("Re√ßu copi√© ‚úÖ"));
}


</script>


    

</body>

</html>


